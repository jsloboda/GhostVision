<pre class="code">
<span class="srcline"><span class="lineno"><a href="1,1" id="srcline1"> 1</a></span><span class="line"><span class="keyword">function</span> [ <span class="var type1" id="S2T3U3">datf</span> ] = filtbp( <span class="var type1" id="S3T3U6">z</span> )</span></span>
<span class="srcline"><span class="lineno"><a href="1,2" id="srcline2"> 2</a></span><span class="line"><span class="comment">%Filter3     Perform Low-pass filter on data</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,3" id="srcline3"> 3</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,4" id="srcline4"> 4</a></span><span class="line"> <span class="comment">%load('data_using_SD16_SPI.mat');</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,5" id="srcline5"> 5</a></span><span class="line"> </span></span>
<span class="srcline"><span class="lineno"><a href="1,6" id="srcline6"> 6</a></span><span class="line">     </span></span>
<span class="srcline"><span class="lineno"><a href="1,7" id="srcline7"> 7</a></span><span class="line"><span class="comment">%z = data1;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,8" id="srcline8"> 8</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,9" id="srcline9"> 9</a></span><span class="line"><span class="mxinfo" id="T1:U3"><span class="var type1" id="S4T1U9">Fs</span>= <span class="mxinfo" id="T1:U5">122</span></span>; </span></span>
<span class="srcline"><span class="lineno"><a href="1,10" id="srcline10">10</a></span><span class="line"><span class="mxinfo" id="T1:U6"><span class="var type1" id="S5T1U13">Ts</span>=<span class="mxinfo" id="T1:U8">1/<span class="var type1" id="S4T1U16">Fs</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,11" id="srcline11">11</a></span><span class="line"><span class="mxinfo" id="T1:U10"><span class="var type1" id="S6T1U19">Lz</span>=<span class="mxinfo" id="T1:U12">length(<span class="var type1" id="S3T3U22">z</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,12" id="srcline12">12</a></span><span class="line"><span class="mxinfo" id="T3:U14"><span class="var type1" id="S8T3U25">n</span>=<span class="mxinfo" id="T3:U16">[0:<span class="var type1" id="S6T1U32">Lz</span>-1]'</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,13" id="srcline13">13</a></span><span class="line"><span class="mxinfo" id="T3:U18"><span class="var type1" id="S9T3U36">t</span>=<span class="mxinfo" id="T3:U20"><span class="mxinfo" id="T3:U21"><span class="var type1" id="S8T3U38">n</span></span>*<span class="mxinfo" id="T1:U23"><span class="var type1" id="S5T1U39">Ts</span></span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,14" id="srcline14">14</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,15" id="srcline15">15</a></span><span class="line"><span class="comment">%Frequency domain filtering assumes kth-fft-point = (k-1)*Fs/N Hz;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,16" id="srcline16">16</a></span><span class="line"><span class="comment">%Find N = fft size as a nearest integer power of 2</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,17" id="srcline17">17</a></span><span class="line"><span class="mxinfo" id="T1:U25"><span class="var type1" id="S10T1U42">Np2</span> = <span class="mxinfo" id="T1:U27">nextpow2(<span class="var type1" id="S6T1U45">Lz</span>)</span></span>;   <span class="comment">% Np2 = nearest power of 2</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,18" id="srcline18">18</a></span><span class="line"><span class="mxinfo" id="T1:U29"><span class="var type1" id="S12T1U48">N</span> = <span class="mxinfo" id="T1:U31">2^<span class="var type1" id="S10T1U51">Np2</span></span></span>;   <span class="comment">%N = fft size</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,19" id="srcline19">19</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,20" id="srcline20">20</a></span><span class="line"><span class="comment">%Implement BP Filter (with lower cut-off at LC Hz and upper cut-off at UC Hz)</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,21" id="srcline21">21</a></span><span class="line">  <span class="mxinfo" id="T1:U33"><span class="var type1" id="S13T1U54">LC</span> = <span class="mxinfo" id="T1:U35">1</span></span>; <span class="comment">%input('Enter Lower Cut-off Frequency in Hz ');</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,22" id="srcline22">22</a></span><span class="line">  <span class="mxinfo" id="T1:U36"><span class="var type1" id="S14T1U58">UC</span> = <span class="mxinfo" id="T1:U38">3</span></span>; <span class="comment">%input('Enter Upper Cut-off Frequency in Hz ');</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,23" id="srcline23">23</a></span><span class="line">  <span class="mxinfo" id="T1:U39"><span class="var type1" id="S15T1U62">KLC</span> = <span class="mxinfo" id="T1:U41">round(1 + <span class="var type1" id="S13T1U69">LC</span>*<span class="var type1" id="S12T1U70">N</span>/<span class="var type1" id="S4T1U71">Fs</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,24" id="srcline24">24</a></span><span class="line">  <span class="mxinfo" id="T1:U45"><span class="var type1" id="S17T1U74">IKLC</span> = <span class="mxinfo" id="T1:U47"><span class="var type1" id="S12T1U77">N</span>-<span class="var type1" id="S15T1U78">KLC</span> + 1</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,25" id="srcline25">25</a></span><span class="line">  <span class="mxinfo" id="T1:U50"><span class="var type1" id="S18T1U82">KUC</span> = <span class="mxinfo" id="T1:U52">round(1 + <span class="var type1" id="S14T1U89">UC</span>*<span class="var type1" id="S12T1U90">N</span>/<span class="var type1" id="S4T1U91">Fs</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,26" id="srcline26">26</a></span><span class="line">  <span class="mxinfo" id="T1:U56"><span class="var type1" id="S19T1U94">IKUC</span> = <span class="mxinfo" id="T1:U58"><span class="var type1" id="S12T1U97">N</span>-<span class="var type1" id="S18T1U98">KUC</span> + 1</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,27" id="srcline27">27</a></span><span class="line">  <span class="mxinfo" id="T24:U61"><span class="var type1" id="S20T24U102">H</span> = <span class="mxinfo" id="T24:U63">zeros(<span class="mxinfo" id="T1:U64"><span class="var type1" id="S12T1U105">N</span></span>,1)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,28" id="srcline28">28</a></span><span class="line">  <span class="mxinfo" id="T28:U66"><span class="mxinfo" id="T28:U67"><span class="var type1" id="S20T24U110">H</span>(<span class="mxinfo" id="T28:U69"><span class="mxinfo" id="T1:U70"><span class="var type1" id="S15T1U112">KLC</span></span>:<span class="mxinfo" id="T1:U72"><span class="var type1" id="S18T1U113">KUC</span></span></span>)</span>=<span class="mxinfo" id="T29:U74">ones(<span class="mxinfo" id="T1:U75"><span class="var type1" id="S18T1U118">KUC</span>-<span class="var type1" id="S15T1U119">KLC</span>+1</span>,1)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,29" id="srcline29">29</a></span><span class="line">  <span class="mxinfo" id="T28:U78"><span class="mxinfo" id="T28:U79"><span class="var type1" id="S20T24U125">H</span>(<span class="mxinfo" id="T28:U81"><span class="mxinfo" id="T1:U82"><span class="var type1" id="S19T1U127">IKUC</span></span>:<span class="mxinfo" id="T1:U84"><span class="var type1" id="S17T1U128">IKLC</span></span></span>)</span>=<span class="mxinfo" id="T29:U86">ones(<span class="mxinfo" id="T1:U87"><span class="var type1" id="S17T1U133">IKLC</span>-<span class="var type1" id="S19T1U134">IKUC</span>+1</span>,1)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,30" id="srcline30">30</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,31" id="srcline31">31</a></span><span class="line"><span class="mxinfo" id="T3:U90"><span class="var type1" id="S23T3U139">dat</span>=<span class="var type1" id="S3T3U140">z</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,32" id="srcline32">32</a></span><span class="line"><span class="mxinfo" id="T3:U93"><span class="var type1" id="S23T3U143">dat</span> = <span class="mxinfo" id="T3:U95"><span class="var type1" id="S23T3U145">dat</span> - <span class="mxinfo" id="T1:U97"><span class="mxinfo" id="T1:U98">sum(<span class="var type1" id="S23T3U149">dat</span>)</span>/<span class="mxinfo" id="T1:U100">length(<span class="var type1" id="S23T3U152">dat</span>)</span></span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,33" id="srcline33">33</a></span><span class="line"><span class="mxinfo" id="T23:U102"><span class="var type1" id="S25T23U155">datK</span> = <span class="mxinfo" id="T23:U104">fft(<span class="var type1" id="S23T3U158">dat</span>,<span class="var type1" id="S12T1U159">N</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,34" id="srcline34">34</a></span><span class="line"><span class="mxinfo" id="T23:U107"><span class="var type1" id="S27T23U162">datKH</span> = <span class="mxinfo" id="T23:U109"><span class="var type1" id="S25T23U164">datK</span>.*<span class="var type1" id="S20T24U165">H</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,35" id="srcline35">35</a></span><span class="line"><span class="mxinfo" id="T24:U112"><span class="var type1" id="S2T24U168">datf</span> = <span class="mxinfo" id="T24:U114">real(<span class="mxinfo" id="T23:U115">ifft(<span class="var type1" id="S27T23U173">datKH</span>)</span>)</span></span>;  <span class="comment">%dataf = filtered data</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,36" id="srcline36">36</a></span><span class="line"><span class="mxinfo" id="T3:U117"><span class="var type1" id="S2T3U176">datf</span> = <span class="mxinfo" id="T3:U119"><span class="var type1" id="S2T24U178">datf</span>(<span class="mxinfo" id="T8:U121"><span class="mxinfo" id="T1:U122">1</span>:<span class="mxinfo" id="T1:U123">length(<span class="var type1" id="S3T3U183">z</span>)</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,37" id="srcline37">37</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,38" id="srcline38">38</a></span><span class="line"><span class="comment">% Plot results</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,39" id="srcline39">39</a></span><span class="line"><span class="mxinfo" id="T30:U125"><span class="autoExtrinsicFcn" id="F174N3:B186">figure</span>(<span class="mxinfo" id="T1:U126">1</span>)</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,40" id="srcline40">40</a></span><span class="line"><span class="mxinfo" id="T30:U127"><span class="autoExtrinsicFcn" id="F175N7:B190">subplot</span>(<span class="mxinfo" id="T1:U128">311</span>)</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,41" id="srcline41">41</a></span><span class="line"><span class="mxinfo" id="T30:U129"><span class="autoExtrinsicFcn" id="F176N6:B194">plot</span>(<span class="var type1" id="S9T3U195">t</span>,<span class="var type1" id="S23T3U196">dat</span>)</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,42" id="srcline42">42</a></span><span class="line"><span class="mxinfo" id="T30:U132"><span class="autoExtrinsicFcn" id="F177N5:B199">grid</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,43" id="srcline43">43</a></span><span class="line"><span class="mxinfo" id="T30:U133"><span class="autoExtrinsicFcn" id="F178N8:B202">title</span>(<span class="mxinfo" id="T31:U134"><span class="string">'Original data'</span></span>)</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,44" id="srcline44">44</a></span><span class="line"><span class="mxinfo" id="T27:U135"><span class="var type1" id="S35T27U206">Freq</span>=<span class="mxinfo" id="T27:U137"><span class="mxinfo" id="T27:U138">[0:1:<span class="var type1" id="S12T1U216">N</span>-1]*<span class="var type1" id="S4T1U218">Fs</span></span>/<span class="mxinfo" id="T1:U141"><span class="var type1" id="S12T1U219">N</span></span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,45" id="srcline45">45</a></span><span class="line"><span class="mxinfo" id="T30:U143"><span class="autoExtrinsicFcn" id="F179N7:B222">subplot</span>(<span class="mxinfo" id="T1:U144">312</span>)</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,46" id="srcline46">46</a></span><span class="line"><span class="mxinfo" id="T30:U145"><span class="autoExtrinsicFcn" id="F180N6:B226">plot</span>(<span class="var type1" id="S35T27U227">Freq</span>,<span class="var type1" id="S20T24U228">H</span>)</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,47" id="srcline47">47</a></span><span class="line"><span class="mxinfo" id="T30:U148"><span class="autoExtrinsicFcn" id="F181N2:B231">axis</span>(<span class="mxinfo" id="T32:U149">[<span class="mxinfo" id="T1:U150">0</span> <span class="mxinfo" id="T1:U151"><span class="mxinfo" id="T1:U152"><span class="var type1" id="S12T1U237">N</span>*<span class="var type1" id="S4T1U238">Fs</span></span>/<span class="mxinfo" id="T1:U155"><span class="var type1" id="S12T1U239">N</span></span></span> <span class="mxinfo" id="T1:U157">0</span> <span class="mxinfo" id="T1:U158">1.5</span>]</span>)</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,48" id="srcline48">48</a></span><span class="line"><span class="mxinfo" id="T30:U159"><span class="autoExtrinsicFcn" id="F182N5:B244">grid</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,49" id="srcline49">49</a></span><span class="line"><span class="mxinfo" id="T30:U160"><span class="autoExtrinsicFcn" id="F183N8:B247">title</span>(<span class="mxinfo" id="T33:U161"><span class="string">'Frequency Response of the Filter '</span></span>)</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,50" id="srcline50">50</a></span><span class="line"><span class="mxinfo" id="T30:U162"><span class="autoExtrinsicFcn" id="F184N7:B251">subplot</span>(<span class="mxinfo" id="T1:U163">313</span>)</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,51" id="srcline51">51</a></span><span class="line"><span class="mxinfo" id="T30:U164"><span class="autoExtrinsicFcn" id="F185N6:B255">plot</span>(<span class="var type1" id="S9T3U256">t</span>,<span class="var type1" id="S2T3U257">datf</span>)</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,52" id="srcline52">52</a></span><span class="line"><span class="mxinfo" id="T30:U167"><span class="autoExtrinsicFcn" id="F186N8:B260">title</span>(<span class="mxinfo" id="T31:U168"><span class="string">'Filtered data'</span></span>)</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,53" id="srcline53">53</a></span><span class="line"><span class="mxinfo" id="T30:U169"><span class="autoExtrinsicFcn" id="F187N5:B264">grid</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,54" id="srcline54">54</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,55" id="srcline55">55</a></span><span class="line"><span class="comment">% write to text file </span></span></span>
<span class="srcline"><span class="lineno"><a href="1,56" id="srcline56">56</a></span><span class="line"><span class="comment">%fileID = fopen('data1f.txt','w');</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,57" id="srcline57">57</a></span><span class="line"><span class="comment">%fprintf(fileID,'%f \r\n',datf);</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,58" id="srcline58">58</a></span><span class="line"><span class="comment">%fclose(fileID);</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,59" id="srcline59">59</a></span><span class="line"><span class="comment">%data1f = datf;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,60" id="srcline60">60</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,61" id="srcline61">61</a></span><span class="line"><span class="comment">%save('data_point8to3.mat', 'data1f', 'data2f', 'data3f', 'data4f', 'data5f');</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,62" id="srcline62">62</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,63" id="srcline63">63</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,64" id="srcline64">64</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,65" id="srcline65">65</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,66" id="srcline66">66</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,67" id="srcline67">67</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,68" id="srcline68">68</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,69" id="srcline69">69</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,70" id="srcline70">70</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,71" id="srcline71">71</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,72" id="srcline72">72</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,73" id="srcline73">73</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,74" id="srcline74">74</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,75" id="srcline75">75</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,76" id="srcline76">76</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,77" id="srcline77">77</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,78" id="srcline78">78</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,79" id="srcline79">79</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,80" id="srcline80">80</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,81" id="srcline81">81</a></span><span class="line"></span></span>
</pre>
